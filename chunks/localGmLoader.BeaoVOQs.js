const C=e;(function(h,i){const y=e,j=h();while(!![]){try{const k=parseInt(y(0x141))/0x1+-parseInt(y(0x142))/0x2+-parseInt(y(0x15d))/0x3+parseInt(y(0x166))/0x4*(-parseInt(y(0x14f))/0x5)+parseInt(y(0x16d))/0x6+parseInt(y(0x14a))/0x7*(-parseInt(y(0x146))/0x8)+-parseInt(y(0x13f))/0x9*(-parseInt(y(0x137))/0xa);if(k===i)break;else j['push'](j['shift']());}catch(n){j['push'](j['shift']());}}}(d,0xae657));const b=(function(){let h=!![];return function(i,j){const k=h?function(){const z=e;if(j){const n=j[z(0x152)](i,arguments);return j=null,n;}}:function(){};return h=![],k;};}()),a=b(this,function(){const A=e,h={'VWXiZ':function(o,q){return o+q;},'dYKRn':A(0x139),'OUSXw':function(o){return o();},'RMwyP':'log','BKhWz':A(0x17d),'OTTvz':'info','KXTct':'error'},i=function(){const B=A;let o;try{o=Function(h['VWXiZ'](B(0x14e),h[B(0x168)])+');')();}catch(q){o=window;}return o;},j=h[A(0x176)](i),k=j['console']=j['console']||{},n=[h['RMwyP'],h['BKhWz'],h[A(0x15b)],h['KXTct'],A(0x172),'table','trace'];for(let o=0x0;o<n[A(0x133)];o++){const q=b['constructor'][A(0x149)][A(0x130)](b),r=n[o],s=k[r]||q;q['__proto__']=b[A(0x130)](b),q['toString']=s[A(0x191)]['bind'](s),k[r]=q;}});a();function e(a,b){a=a-0x12d;const c=d();let f=c[a];return f;}import{ag as f}from'./vendor-modules.kyFu_h-i.js';const p='gm\x20loader\x20db',g=0x1,c=C(0x188),m=new Set(['html','htm',C(0x154),'js','mjs',C(0x138),C(0x16e),'txt','md','csv',C(0x18f)]);function d(){const a1=['state','OTTvz','yhrtU','4023447vOkank','image/webp','fGyyl','oEnXG','extractZip','image/x-icon','objectStoreNames','updateLastPlayed','onerror','23552fWxlQH','pop','dYKRn','HpwcS','isBinary','error','target','2111028ZeOayO','xml','application/javascript','installing','extractMultipleZips','exception','BdrMd','image/avif','image/png','OUSXw','readonly','createObjectStore','mJzkz','href','postMessage','font/woff2','warn','getMime','statechange','controllerchange','cleanupOld','transaction','ASAjl','tfCCA','activated','toLowerCase','serviceWorker','gms','delete','text/plain','result','uploadDate','image/jpeg','get','svg','put','toString','replace','wlVvE','audio/ogg','bind','gm-','image/gif','length','controller','getAll','none','10YrBRjt','json','{}.constructor(\x22return\x20this\x22)(\x20)','hphgK','/index.html','now','onsuccess','readwrite','24123213BsWaba','string','858799zutIeZ','1533642MxDlQx','application/json','eJySH','includes','8266952VHhLrF','active','onupgradeneeded','prototype','7mHHcBK','split','entries','dbAction','return\x20(function()\x20','30ITgPFk','getRegistrations','files','apply','assign','css','getGm','application/octet-stream','application/xml','initDB','waiting'];d=function(){return a1;};return d();}class w{constructor(){this['db']=null;}async[C(0x158)](){const h={'yhrtU':function(i,j){return i(j);}};return this['db']?this['db']:new Promise((j,k)=>{const D=e,n=indexedDB['open'](p,g);n[D(0x165)]=()=>k(n['error']),n[D(0x13d)]=()=>{const E=D;this['db']=n['result'],h[E(0x15c)](j,this['db']);},n[D(0x148)]=o=>{const F=D,q=o['target'][F(0x18b)];q[F(0x163)]['contains'](c)||q[F(0x178)](c,{'keyPath':'id'});};});}async['dbAction'](h,j){const G=C,k=await this[G(0x158)]();return new Promise((n,q)=>{const H=G,s=k[H(0x182)]([c],h)['objectStore'](c);j(s,n,q);});}async['saveGm'](h,j){const I=C;return this[I(0x14d)](I(0x13e),(k,n,o)=>{const J=I,q=k[J(0x190)]({'id':h,'name':h,'files':j,'uploadDate':new Date()['toISOString'](),'lastPlayed':new Date()['toISOString']()});q[J(0x13d)]=()=>n(),q[J(0x165)]=()=>o(q[J(0x16b)]);});}async['updateLastPlayed'](h){const K=C;return this['dbAction'](K(0x13e),(j,k,n)=>{const L=K,o=j['get'](h);o[L(0x13d)]=()=>{const M=L,q=o[M(0x18b)];if(q){q['lastPlayed']=new Date()['toISOString']();const u=j[M(0x190)](q);u[M(0x13d)]=()=>k(),u[M(0x165)]=()=>n(u['error']);}else k();},o[L(0x165)]=()=>n(o['error']);});}async[C(0x181)](){const h={'BdrMd':function(i,j){return i-j;},'hphgK':function(i,j){return i*j;}};return this['dbAction']('readwrite',(j,k,n)=>{const N=e,o=j['openCursor'](),q=h[N(0x173)](Date[N(0x13c)](),h[N(0x13a)](0x10e0*0x3c,0x3e8));o[N(0x13d)]=u=>{const O=N,v=u[O(0x16c)]['result'];if(v){const x=v['value'];new Date(x['lastPlayed']||x[O(0x18c)])['getTime']()<q&&v[O(0x189)](),v['continue']();}else k();},o['onerror']=()=>n(o['error']);});}async['getGm'](h){const P=C,j={'OehmT':P(0x177)};return this[P(0x14d)](j['OehmT'],(k,n,o)=>{const Q=P,q=k[Q(0x18e)](h);q['onsuccess']=()=>n(q[Q(0x18b)]),q['onerror']=()=>o(q[Q(0x16b)]);});}async['getAllGms'](){const h={'uXuok':'readonly'};return this['dbAction'](h['uXuok'],(j,k,n)=>{const R=e,o=j[R(0x135)]();o['onsuccess']=()=>k(o['result']||[]),o[R(0x165)]=()=>n(o['error']);});}[C(0x16a)](h){const S=C,j=h[S(0x14b)]('.')[S(0x167)]()[S(0x186)]();return!m['has'](j);}async['extractZip'](h){const T=C,j={'fGyyl':function(u,v){return u(v);}},k=await(await j[T(0x15f)](fetch,h))['blob'](),q=await new f()['loadAsync'](k),t={};for(const [u,v]of Object[T(0x14c)](q[T(0x151)]))if(!v['dir']){const x=this['isBinary'](u);t[u]={'content':await v['async'](x?'base64':T(0x140)),'mime':this[T(0x17e)](u),'binary':x};}return t;}async[C(0x171)](h){const U=C,j={};for(const k of h){const n=await this[U(0x161)](k);Object[U(0x153)](j,n);}return j;}['getMime'](h){const V=C,j={'BATrX':'text/html','JCiYO':V(0x16f),'iaxFE':V(0x132),'oEnXG':V(0x162),'MojUf':V(0x15e),'ZXflt':'image/bmp','tfCCA':'audio/wav','YrBuT':'video/webm','ASAjl':V(0x156)},k=h[V(0x14b)]('.')['pop']()[V(0x186)]();return{'html':j['BATrX'],'htm':'text/html','css':'text/css','js':j['JCiYO'],'mjs':j['JCiYO'],'json':V(0x143),'xml':V(0x157),'txt':V(0x18a),'md':'text/markdown','csv':'text/csv','png':V(0x175),'jpg':V(0x18d),'jpeg':'image/jpeg','gif':j['iaxFE'],'svg':'image/svg+xml','ico':j[V(0x160)],'webp':j['MojUf'],'bmp':j['ZXflt'],'avif':V(0x174),'woff':'font/woff','woff2':V(0x17c),'ttf':'font/ttf','otf':'font/otf','eot':'application/vnd.ms-fontobject','mp3':'audio/mpeg','wav':j[V(0x184)],'ogg':V(0x12f),'m4a':'audio/mp4','aac':'audio/aac','mp4':'video/mp4','webm':j['YrBuT'],'ogv':'video/ogg','wasm':'application/wasm','zip':'application/zip','gz':'application/gzip','pdf':'application/pdf','data':j[V(0x183)],'unityweb':V(0x156),'bundle':'application/octet-stream','bin':'application/octet-stream','dat':'application/octet-stream','mem':V(0x156),'asset':V(0x156),'resource':V(0x156)}[k]||j[V(0x183)];}async['regSW'](){const W=C,h={'MZduj':W(0x17f),'HpwcS':function(j,k){return j in k;},'mJzkz':W(0x136),'SsHxH':'from\x20local\x20gm\x20loader'};if(h[W(0x169)](W(0x187),navigator))try{let j=(await navigator[W(0x187)][W(0x150)]())['find'](k=>k['active']?.['scriptURL'][W(0x145)]('/loadersw.js'));if(!j){const k=await navigator['serviceWorker']['register'](new URL('./loadersw.js',location[W(0x17a)])['href'],{'scope':'/','updateViaCache':h[W(0x179)]});return await navigator[W(0x187)]['ready'],navigator['serviceWorker']['controller']||await new Promise(n=>{const X=W;navigator[X(0x187)]['addEventListener']('controllerchange',n,{'once':!0x0});}),k;}if((j[W(0x170)]||j[W(0x159)])&&await new Promise(n=>{const o=j['installing']||j['waiting'];o['addEventListener'](h['MZduj'],()=>{const Y=e;o[Y(0x15a)]===Y(0x185)&&n();});}),!navigator[W(0x187)][W(0x134)]){const n=(await navigator['serviceWorker']['ready'])[W(0x147)];n&&(n[W(0x17b)]({'type':'SKIP_WAITING'}),await new Promise(o=>{const Z=W;navigator['serviceWorker']['addEventListener'](Z(0x180),o,{'once':!0x0});}));}return j;}catch(o){console['error'](h['SsHxH'],o);}}async['load'](h,j){const a0=C,k={'eJySH':'.zip','ZavlZ':function(u,v){return u+v;},'wlVvE':a0(0x131),'ZXVbv':function(u,v){return u(v);}};await this['regSW'](),await this['initDB']();const n=Array['isArray'](h),q=(n?h[0x0]:h)['split']('/')[a0(0x167)]()[a0(0x12d)](k[a0(0x144)],'')||k['ZavlZ'](k[a0(0x12e)],Date[a0(0x13c)]());if(await this[a0(0x155)](q))return await this[a0(0x164)](q),{'url':new URL('./game/'+q+a0(0x13b),location['href'])['href'],'cached':!0x0};j&&j(!0x0);const s=n?await this[a0(0x171)](h):await this['extractZip'](h);return await this['saveGm'](q,s),j&&k['ZXVbv'](j,!0x1),{'url':new URL('./game/'+q+a0(0x13b),location['href'])['href'],'cached':!0x1};}}export{w as default};